% Define beam properties

L = 1; % Length of the beam in meters
a = 6.35e-3; % Side length of the square cross-section in meters
I = a^4 / 12; % Moment of inertia
E = 69e9; % Young's modulus in Pa
rho = 2700; % Density of aluminum in kg/m^3
k1 = 1.87510407; % First mode approximated root for clamped-free beam
P = -10; % Tip payload in Newtons
EI = E * I; % The flexural rigidity

% Adjusted boundary conditions for the clamped-free beam with a tip payload
M = P * L; % Moment at the free end due to payload

R = [1, 0, 1, 0; % phi(0) = 0
     0, 1, 0, 1; % phi'(0) = 0
     -sin(k1*L), -cos(k1*L), sinh(k1*L), cosh(k1*L); % Adjusted for moment
     -cos(k1*L), sin(k1*L), cosh(k1*L), sinh(k1*L)]; % Adjusted for shear force

f = [0; 0; M/EI; 0]; % Right-hand side vector

% Solve for coefficients C1, C2, C3, C4
C = pinv(R)*f;

% Display the solution for coefficients
disp('Coefficients [C1; C2; C3; C4] for the mode shape:');
disp(C);

% Define symbolic variable

syms x

% Calculate sigma for normalization (if required)
%sigma = -(sin(k1*L) + sinh(k1*L)) / (cos(k1*L) + cosh(k1*L));
% Define the first mode shape phi2(x)
%phi2 = C(3)*(sin(k1*x) - sinh(k1*x)) + C(3)*sigma*(cos(k1*x) - cosh(k1*x));
%phi2=C(1)*sin(k1*x)+C(2)*cos(k1*x)+C(3)*sinh(k1*x)+C(4)*cosh(k1*x);

phi2=(1204306519316021*11417981541647679048466287755595961091061972992^(1/2)*141153237138531503619427459802038107605809441625^(1/2)*exp(-(11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4)*x)/11417981541647679048466287755595961091061972992)*exp(-(11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4)*x*1i)/11417981541647679048466287755595961091061972992)*(exp((11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4)*x)/11417981541647679048466287755595961091061972992)*exp((11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4)*1i)/11417981541647679048466287755595961091061972992)*(1 + 1i) - exp((11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4)*x*1i)/11417981541647679048466287755595961091061972992)*exp((11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4))/11417981541647679048466287755595961091061972992)*(1 - 1i) + 2*exp((11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4)*x)/11417981541647679048466287755595961091061972992)*exp((11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4))/11417981541647679048466287755595961091061972992)*exp((11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4)*1i)/5708990770823839524233143877797980545530986496) + exp((11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4)*x)/11417981541647679048466287755595961091061972992)*exp((11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4))/5708990770823839524233143877797980545530986496)*exp((11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4)*1i)/11417981541647679048466287755595961091061972992)*(1 - 1i) - exp((11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4)*x*1i)/11417981541647679048466287755595961091061972992)*exp((11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4))/11417981541647679048466287755595961091061972992)*exp((11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4)*1i)/5708990770823839524233143877797980545530986496)*(1 + 1i) - 2*exp((11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4)*x*1i)/11417981541647679048466287755595961091061972992)*exp((11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4))/5708990770823839524233143877797980545530986496)*exp((11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4)*1i)/11417981541647679048466287755595961091061972992) + 2*exp((11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4)*x)/11417981541647679048466287755595961091061972992)*exp((11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4)*x*1i)/5708990770823839524233143877797980545530986496)*exp((11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4))/11417981541647679048466287755595961091061972992) - exp((11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4)*x)/5708990770823839524233143877797980545530986496)*exp((11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4)*x*1i)/11417981541647679048466287755595961091061972992)*exp((11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4))/11417981541647679048466287755595961091061972992)*(1 + 1i) + exp((11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4)*x)/11417981541647679048466287755595961091061972992)*exp((11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4)*x*1i)/5708990770823839524233143877797980545530986496)*exp((11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4)*1i)/11417981541647679048466287755595961091061972992)*(1 - 1i) - 2*exp((11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4)*x)/5708990770823839524233143877797980545530986496)*exp((11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4)*x*1i)/11417981541647679048466287755595961091061972992)*exp((11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4)*1i)/11417981541647679048466287755595961091061972992) + exp((11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4)*x)/11417981541647679048466287755595961091061972992)*exp((11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4)*x*1i)/5708990770823839524233143877797980545530986496)*exp((11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4))/5708990770823839524233143877797980545530986496)*exp((11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4)*1i)/11417981541647679048466287755595961091061972992)*(1 + 1i) - exp((11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4)*x)/5708990770823839524233143877797980545530986496)*exp((11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4)*x*1i)/11417981541647679048466287755595961091061972992)*exp((11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4))/11417981541647679048466287755595961091061972992)*exp((11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4)*1i)/5708990770823839524233143877797980545530986496)*(1 - 1i)))/(317848833089614868387540012941499855700062587525475124379648000*(exp((11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4))/5708990770823839524233143877797980545530986496) + exp((11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4)*1i)/5708990770823839524233143877797980545530986496) + 4*exp((11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4))/11417981541647679048466287755595961091061972992)*exp((11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4)*1i)/11417981541647679048466287755595961091061972992) + exp((11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4))/5708990770823839524233143877797980545530986496)*exp((11417981541647679048466287755595961091061972992^(3/4)*141153237138531503619427459802038107605809441625^(1/4)*1i)/5708990770823839524233143877797980545530986496) + 1));
    
% Convert symbolic expression to numeric function for plotting
phi2_func = matlabFunction(phi2);

% Generate x values from 0 to L
x_vals = linspace(0, L, 100);

% Evaluate phi2 over x_vals
phi2_vals = phi2_func(x_vals);

realtipdisplacement=0.53482;

cf=max(phi2_vals)/realtipdisplacement;

% Plot phi2(x)
figure(1);
plot(x_vals, phi2_vals/cf, 'b-', 'LineWidth', 2);
xlabel('x (meters)');
ylabel('\phi_2(x)');
title('Second Mode Shape of the Clamped-Free Beam with Tip Payload');
grid on;

D2phi2a=subs(diff(phi2,x,2),x,L/2);
phi2a=subs(phi2,x,L/2);
phi2L=subs(phi2,x,L);

% Calculate gamma_i (gamma_1 for the first mode) using symbolic integration

% Display the result
gamma_2 = int(x*phi2, x, 0, L)/cf;
disp('Gamma_2 for the first mode:');
disp(gamma_2);